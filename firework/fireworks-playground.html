<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒŸèŠ±ç§€ | Fireworks Playground</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+SC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --neon-pink: #ff00ff;
            --neon-cyan: #00ffff;
            --neon-yellow: #ffff00;
            --deep-purple: #0a0015;
            --dark-blue: #050510;
        }

        body {
            margin: 0;
            overflow: hidden;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            font-family: 'Noto Sans SC', sans-serif;
            cursor: crosshair;
        }

        /* æ˜Ÿç©ºèƒŒæ™¯ */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Canvas */
        #fireworksCanvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg,
                rgba(10, 0, 21, 0.98) 0%,
                rgba(5, 5, 16, 0.96) 100%);
            backdrop-filter: blur(30px) saturate(180%);
            border: 2px solid transparent;
            background-image:
                linear-gradient(135deg, rgba(10, 0, 21, 0.98) 0%, rgba(5, 5, 16, 0.96) 100%),
                linear-gradient(135deg,
                    rgba(255, 0, 255, 0.5) 0%,
                    rgba(0, 255, 255, 0.5) 50%,
                    rgba(255, 0, 255, 0.5) 100%);
            background-origin: padding-box, border-box;
            background-clip: padding-box, border-box;
            border-radius: 24px;
            padding: 24px 20px 20px;
            width: 340px;
            max-height: calc(100vh - 40px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4),
                        0 0 0 1px rgba(255, 255, 255, 0.05) inset,
                        0 0 60px rgba(255, 0, 255, 0.25),
                        0 0 120px rgba(0, 255, 255, 0.12);
            z-index: 1000;
            font-family: 'Orbitron', sans-serif;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.4s;
            display: flex;
            flex-direction: column;
        }

        .control-panel.hidden {
            transform: translateX(calc(100% + 40px));
            opacity: 0;
            pointer-events: none;
        }

        /* å±•å¼€æŒ‰é’®ï¼ˆé¢æ¿éšè—æ—¶æ˜¾ç¤ºï¼‰ */
        .expand-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 0, 255, 0.3);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 0, 255, 0.5);
            border-radius: 15px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 999;
            transition: all 0.3s;
            opacity: 0;
            pointer-events: none;
            transform: translateX(80px);
        }

        .expand-btn.show {
            opacity: 1;
            pointer-events: all;
            transform: translateX(0);
        }

        .expand-btn:hover {
            background: rgba(255, 0, 255, 0.5);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.8);
            transform: scale(1.1);
        }

        .expand-btn svg {
            width: 24px;
            height: 24px;
            fill: var(--neon-pink);
        }

        /* é¢æ¿å¤´éƒ¨ */
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            flex-shrink: 0;
        }

        /* æŠ˜å æŒ‰é’® */
        .toggle-btn {
            background: rgba(255, 0, 255, 0.2);
            border: 1px solid rgba(255, 0, 255, 0.5);
            border-radius: 8px;
            color: var(--neon-pink);
            width: 36px;
            height: 36px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toggle-btn:hover {
            background: rgba(255, 0, 255, 0.4);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.6);
            transform: scale(1.1);
        }

        /* é¡¶éƒ¨æŒ‰é’®åŒº */
        .top-buttons {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(255, 0, 255, 0.25);
            flex-shrink: 0;
        }

        .top-buttons .button-group {
            margin-bottom: 10px;
        }

        .top-buttons .button-group:last-child {
            margin-bottom: 0;
        }

        /* å¯æŠ˜å å†…å®¹åŒº */
        .panel-content {
            overflow-y: auto;
            overflow-x: hidden;
            flex: 1;
            min-height: 0;
            padding-right: 8px;
            padding-bottom: 16px;
            margin-right: -8px;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
        }

        .panel-content.collapsed {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .panel-content::-webkit-scrollbar {
            width: 8px;
        }

        .panel-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin: 4px 0;
        }

        .panel-content::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg,
                rgba(255, 0, 255, 0.6) 0%,
                rgba(0, 255, 255, 0.6) 100%);
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: padding-box;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.4);
        }

        .panel-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg,
                rgba(255, 0, 255, 0.8) 0%,
                rgba(0, 255, 255, 0.8) 100%);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.6);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .panel-title {
            font-size: 24px;
            font-weight: 900;
            color: var(--neon-cyan);
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .control-group {
            margin-bottom: 18px;
        }

        .control-group:last-child {
            margin-bottom: 24px;
        }

        .section-divider {
            border-top: 2px solid transparent;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255, 0, 255, 0.4) 20%,
                rgba(0, 255, 255, 0.4) 80%,
                transparent 100%);
            padding-top: 18px;
            margin-top: 14px;
            margin-bottom: 4px;
            position: relative;
        }

        .section-divider::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255, 0, 255, 0.6) 50%,
                transparent 100%);
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.4);
        }

        .section-label {
            color: var(--neon-pink);
            text-shadow: 0 0 15px rgba(255, 0, 255, 0.8);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-label::before {
            content: '';
            width: 4px;
            height: 16px;
            background: linear-gradient(180deg,
                var(--neon-pink) 0%,
                var(--neon-cyan) 100%);
            border-radius: 2px;
            box-shadow: 0 0 8px rgba(255, 0, 255, 0.6);
        }


        .control-label {
            display: block;
            color: rgba(255, 255, 255, 0.95);
            font-size: 12px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
        }

        .slider-container {
            position: relative;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            outline: none;
            -webkit-appearance: none;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        input[type="range"]:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg,
                rgba(255, 0, 255, 1) 0%,
                rgba(0, 255, 255, 1) 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.8),
                        0 0 25px rgba(0, 255, 255, 0.4);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.3);
            box-shadow: 0 0 20px rgba(255, 0, 255, 1),
                        0 0 35px rgba(0, 255, 255, 0.6);
        }

        input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(1.2);
        }

        .slider-value {
            position: absolute;
            right: 0;
            top: -28px;
            color: var(--neon-cyan);
            font-size: 13px;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            background: rgba(0, 255, 255, 0.1);
            padding: 2px 8px;
            border-radius: 6px;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        /* æŒ‰é’®ç»„ */
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 13px 20px;
            border: 2px solid;
            border-radius: 14px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 11px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            letter-spacing: 1.2px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-primary {
            border-color: var(--neon-pink);
            color: var(--neon-pink);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.2);
        }

        .btn-primary:hover {
            background: var(--neon-pink);
            color: var(--deep-purple);
            box-shadow: 0 0 25px rgba(255, 0, 255, 0.6),
                        0 4px 15px rgba(255, 0, 255, 0.4);
            transform: translateY(-3px);
        }

        .btn-secondary {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: var(--neon-cyan);
            color: var(--deep-purple);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.6),
                        0 4px 15px rgba(0, 255, 255, 0.4);
            transform: translateY(-3px);
        }

        .btn.active {
            background: var(--neon-pink);
            color: var(--deep-purple);
            box-shadow: 0 0 25px rgba(255, 0, 255, 0.8);
            transform: scale(0.98);
        }

        .btn-special {
            grid-column: 1 / -1;
            border-color: var(--neon-yellow);
            color: var(--neon-yellow);
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.3);
            font-size: 13px;
            font-weight: 900;
            background: linear-gradient(135deg,
                rgba(255, 0, 255, 0.08),
                rgba(255, 255, 0, 0.08));
            animation: pulse 2s ease-in-out infinite;
            position: relative;
        }

        .btn-special::after {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 14px;
            padding: 2px;
            background: linear-gradient(45deg,
                var(--neon-pink),
                var(--neon-yellow),
                var(--neon-cyan));
            -webkit-mask: linear-gradient(#fff 0 0) content-box,
                          linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .btn-special:hover::after {
            opacity: 1;
        }

        .btn-special:hover {
            background: linear-gradient(135deg,
                var(--neon-pink),
                var(--neon-yellow));
            color: var(--deep-purple);
            box-shadow: 0 0 40px rgba(255, 255, 0, 0.8),
                        0 6px 20px rgba(255, 255, 0, 0.4);
            transform: translateY(-4px) scale(1.02);
        }

        .btn-special.active {
            background: linear-gradient(135deg,
                var(--neon-yellow),
                var(--neon-pink));
            color: var(--deep-purple);
            box-shadow: 0 0 40px rgba(255, 255, 0, 1);
            animation: pulse 1s ease-in-out infinite;
        }

        .btn-full {
            width: 100%;
            margin-top: 10px;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255, 255, 0, 0.3);
            }
            50% {
                box-shadow: 0 0 35px rgba(255, 255, 0, 0.6);
            }
        }

        /* çƒŸèŠ±ç±»å‹é€‰æ‹©å™¨ */
        .type-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 12px;
        }

        .type-btn {
            padding: 10px 8px;
            border: 1.5px solid rgba(255, 255, 255, 0.25);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.04);
            color: rgba(255, 255, 255, 0.9);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            font-family: 'Orbitron', sans-serif;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .type-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--neon-cyan);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 255, 255, 0.2);
        }

        .type-btn.active {
            background: linear-gradient(135deg,
                rgba(255, 0, 255, 0.25) 0%,
                rgba(0, 255, 255, 0.25) 100%);
            border-color: var(--neon-pink);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.4),
                        inset 0 0 10px rgba(255, 0, 255, 0.1);
            color: white;
            transform: translateY(-1px);
        }

        /* æ–‡å­—è¾“å…¥æ¡†æ ·å¼ */
        #textInput {
            width: 100%;
            padding: 12px 15px;
            background: rgba(10, 0, 21, 0.7);
            border: 2px solid rgba(255, 0, 255, 0.4);
            border-radius: 12px;
            color: white;
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 14px;
            outline: none;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.4);
        }

        #textInput:focus {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4),
                        inset 0 2px 8px rgba(0, 0, 0, 0.4);
            background: rgba(10, 0, 21, 0.9);
        }

        #textInput::placeholder {
            color: rgba(255, 255, 255, 0.4);
            font-size: 13px;
        }


        /* æ ‡é¢˜ */
        .main-title {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Orbitron', sans-serif;
            font-size: 48px;
            font-weight: 900;
            color: white;
            text-shadow: 0 0 20px rgba(255, 0, 255, 0.8),
                         0 0 40px rgba(0, 255, 255, 0.6);
            z-index: 100;
            animation: titleGlow 2s infinite alternate;
            letter-spacing: 8px;
            pointer-events: all;
            cursor: text;
            outline: none;
            padding: 10px 20px;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .main-title:hover {
            background: rgba(255, 0, 255, 0.1);
            text-shadow: 0 0 25px rgba(255, 0, 255, 1),
                         0 0 50px rgba(0, 255, 255, 0.8);
        }

        .main-title:focus {
            background: rgba(255, 0, 255, 0.2);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
        }

        @keyframes titleGlow {
            from {
                text-shadow: 0 0 20px rgba(255, 0, 255, 0.8),
                             0 0 40px rgba(0, 255, 255, 0.6);
            }
            to {
                text-shadow: 0 0 30px rgba(255, 0, 255, 1),
                             0 0 60px rgba(0, 255, 255, 0.8),
                             0 0 80px rgba(255, 255, 0, 0.4);
            }
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .control-panel {
                top: 10px;
                right: 10px;
                padding: 15px;
                min-width: 200px;
            }

            .main-title {
                font-size: 32px;
                top: 20px;
            }

            .panel-title {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
    <div class="stars" id="stars"></div>

    <!-- ä¸»æ ‡é¢˜ï¼ˆå¯ç¼–è¾‘ï¼‰ -->
    <h1 class="main-title" id="mainTitle" contenteditable="true">FIREWORKS</h1>

    <!-- Canvas -->
    <canvas id="fireworksCanvas"></canvas>

    <!-- å±•å¼€æŒ‰é’®ï¼ˆé¢æ¿éšè—æ—¶æ˜¾ç¤ºï¼‰ -->
    <div class="expand-btn" id="expandBtn">
        <svg viewBox="0 0 24 24">
            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
        </svg>
    </div>

    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel" id="controlPanel">
        <div class="panel-header">
            <div class="panel-title">âš¡ æ§åˆ¶å°</div>
            <button class="toggle-btn" id="togglePanel">â–¶</button>
        </div>

        <!-- æŒ‰é’®ç»„ç½®äºé¡¶éƒ¨ -->
        <div class="top-buttons">
            <div class="button-group">
                <button class="btn btn-special" id="allEffectsBtn">ğŸ† å…¨éƒ¨æ•ˆæœ</button>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" id="autoBtn">è‡ªåŠ¨æ¨¡å¼</button>
                <button class="btn btn-secondary" id="clearBtn">æ¸…ç©º</button>
            </div>
        </div>

        <!-- å¯æŠ˜å çš„æ§åˆ¶å†…å®¹ -->
        <div class="panel-content" id="panelContent">
            <div class="control-group">
                <label class="control-label">çƒŸèŠ±ç±»å‹</label>
                <div class="type-selector">
                    <button class="type-btn active" data-type="classic">ğŸ† ç»å…¸</button>
                    <button class="type-btn" data-type="fountain">â›² å–·æ³‰</button>
                    <button class="type-btn" data-type="heart">ğŸ’– å¿ƒå½¢</button>
                    <button class="type-btn" data-type="spiral">ğŸŒ€ èºæ—‹</button>
                    <button class="type-btn" data-type="ring">â­• å…‰ç¯</button>
                    <button class="type-btn" data-type="meteor">â˜„ï¸ æµæ˜Ÿé›¨</button>
                    <button class="type-btn" data-type="double">ğŸ’¥ åŒçˆ†</button>
                    <button class="type-btn" data-type="star">â­ æ˜Ÿæ˜Ÿ</button>
                    <button class="type-btn" data-type="wave">ğŸŒŠ æ³¢æµª</button>
                    <button class="type-btn" data-type="rainbow">ğŸŒˆ å½©è™¹</button>
                    <button class="type-btn" data-type="cross">âœ¨ åå­—</button>
                    <button class="type-btn" data-type="diamond">ğŸ’ é’»çŸ³</button>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">âœ¨ æ–‡å­—çƒŸèŠ±</label>
                <input type="text" id="textInput" placeholder="è¾“å…¥æƒ³å±•ç¤ºçš„æ–‡å­—..." maxlength="20">
                <button class="btn btn-primary btn-full" id="textFireworkBtn">
                    ğŸ† æ‰“å‡ºæ–‡å­—çƒŸèŠ±
                </button>
            </div>

            <div class="control-group">
                <label class="control-label">ç²’å­å¯†åº¦</label>
                <div class="slider-container">
                    <span class="slider-value" id="densityValue">100</span>
                    <input type="range" id="density" min="50" max="300" value="100">
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">å‘å°„é€Ÿåº¦</label>
                <div class="slider-container">
                    <span class="slider-value" id="speedValue">10</span>
                    <input type="range" id="speed" min="5" max="20" value="10">
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">é‡åŠ›å¼ºåº¦</label>
                <div class="slider-container">
                    <span class="slider-value" id="gravityValue">0.15</span>
                    <input type="range" id="gravity" min="0.05" max="0.3" step="0.01" value="0.15">
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">ç²’å­å¤§å°</label>
                <div class="slider-container">
                    <span class="slider-value" id="particleSizeValue">3</span>
                    <input type="range" id="particleSize" min="1" max="8" step="0.5" value="3">
                </div>
            </div>

            <!-- æ–‡å­—çƒŸèŠ±ä¸“å±å‚æ•° -->
            <div class="control-group section-divider">
                <label class="control-label section-label">ğŸ“ æ–‡å­—çƒŸèŠ±å‚æ•°</label>
            </div>

            <div class="control-group">
                <label class="control-label">ç¬”ç”»ç²—ç»†</label>
                <div class="slider-container">
                    <span class="slider-value" id="strokeWidthValue">20</span>
                    <input type="range" id="strokeWidth" min="10" max="50" step="1" value="20">
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">ç«èŠ±å¯†åº¦</label>
                <div class="slider-container">
                    <span class="slider-value" id="sparkDensityValue">0.5</span>
                    <input type="range" id="sparkDensity" min="0.1" max="1" step="0.1" value="0.5">
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">ç«èŠ±å¤§å°</label>
                <div class="slider-container">
                    <span class="slider-value" id="sparkSizeValue">2</span>
                    <input type="range" id="sparkSize" min="1" max="5" step="0.5" value="2">
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">å‘å…‰å¼ºåº¦</label>
                <div class="slider-container">
                    <span class="slider-value" id="glowIntensityValue">0.7</span>
                    <input type="range" id="glowIntensity" min="0.5" max="3" step="0.1" value="0.7">
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">ä¹¦å†™é€Ÿåº¦</label>
                <div class="slider-container">
                    <span class="slider-value" id="writeSpeedValue">1.2</span>
                    <input type="range" id="writeSpeed" min="0.5" max="3" step="0.1" value="1.2">
                </div>
            </div>
        </div>
    </div>

    <script>
        // Canvas è®¾ç½®
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // åˆ›å»ºæ˜Ÿç©º
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 2 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }
        createStars();

        // é…ç½®
        let config = {
            type: 'classic',
            density: 100,
            speed: 10,
            gravity: 0.15,
            autoMode: false,
            particleSize: 3, // ç²’å­å¤§å°
            // æ–‡å­—çƒŸèŠ±é…ç½®
            textStrokeWidth: 20, // ç¬”ç”»ç²—ç»†ï¼ˆé»˜è®¤æ”¹ä¸º20ï¼‰
            textSparkDensity: 0.5, // ç«èŠ±å¯†åº¦ 0-1
            textSparkSize: 2, // ç«èŠ±å¤§å°
            textGlowIntensity: 0.7, // å‘å…‰å¼ºåº¦ï¼ˆé»˜è®¤æ”¹ä¸º0.7ï¼‰
            textWriteSpeed: 0.012, // ä¹¦å†™é€Ÿåº¦
            textFadeInTime: 0, // æ— æ¸æ˜¾ï¼ˆå›ºå®šå€¼ï¼‰
            textDisplayTime: 300, // å±•ç¤º5ç§’åè‡ªåŠ¨æ¸éšï¼ˆå›ºå®šå€¼ï¼Œ300å¸§ = 5ç§’ï¼‰
            textFadeOutTime: 90, // æ¸éš1.5ç§’ï¼ˆå›ºå®šå€¼ï¼Œ90å¸§ = 1.5ç§’ï¼‰
            // é¡µé¢æ ‡é¢˜
            pageTitle: 'FIREWORKS',
            // å…¨éƒ¨æ•ˆæœæ¨¡å¼
            allEffectsMode: false,
            allEffectsInterval: null
        };

        // ç²’å­ç±»
        class Particle {
            constructor(x, y, color, velocity, gravity = config.gravity) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.velocity = velocity;
                this.gravity = gravity;
                this.alpha = 1;
                this.decay = Math.random() * 0.02 + 0.01;
                this.size = Math.random() * config.particleSize + config.particleSize * 0.5;
                this.trail = [];
            }

            update() {
                // æ™®é€šç²’å­çš„è¿åŠ¨é€»è¾‘
                this.velocity.y += this.gravity;
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.alpha -= this.decay;

                // æ·»åŠ æ‹–å°¾æ•ˆæœ
                this.trail.push({ x: this.x, y: this.y, alpha: this.alpha });
                if (this.trail.length > 10) {
                    this.trail.shift();
                }
            }

            draw() {
                // ç»˜åˆ¶æ‹–å°¾
                ctx.save();
                this.trail.forEach((point, index) => {
                    ctx.globalAlpha = point.alpha * (index / this.trail.length) * 0.5;
                    ctx.fillStyle = this.color;
                    ctx.fillRect(point.x, point.y, this.size * 0.5, this.size * 0.5);
                });
                ctx.restore();

                // ç»˜åˆ¶ç²’å­æœ¬ä½“ï¼ˆå¸¦å‘å…‰æ•ˆæœï¼‰
                ctx.save();
                ctx.globalAlpha = this.alpha;

                // å¤–å‘å…‰
                const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size * 2);
                gradient.addColorStop(0, this.color);
                gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(this.x - this.size * 2, this.y - this.size * 2, this.size * 4, this.size * 4);

                // æ ¸å¿ƒ
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - this.size / 2, this.y - this.size / 2, this.size, this.size);
                ctx.restore();
            }

            isDead() {
                return this.alpha <= 0;
            }
        }

        // ç«èŠ±ç²’å­ç±»ï¼ˆç”¨äºæ–‡å­—çƒŸèŠ±ï¼‰
        class SparkParticle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                // å‘å¤–é£æ•£çš„é€Ÿåº¦
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 3 + 1;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed - Math.random() * 2; // å‘ä¸Šçš„åç§»
                this.gravity = 0.1;
                this.alpha = 1;
                this.decay = Math.random() * 0.02 + 0.015;
                this.size = Math.random() * config.textSparkSize + config.textSparkSize * 0.5;
                // é‡‘è‰²
                this.color = `rgba(255, ${200 + Math.random() * 55}, ${Math.random() * 100}, ${this.alpha})`;
            }

            update() {
                this.vy += this.gravity;
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= this.decay;
                this.vx *= 0.98; // ç©ºæ°”é˜»åŠ›
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;

                // å‘å…‰æ•ˆæœï¼ˆä½¿ç”¨é…ç½®çš„å‘å…‰å¼ºåº¦ï¼‰
                const glowRadius = this.size * 3 * config.textGlowIntensity;
                const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, glowRadius);
                gradient.addColorStop(0, `rgba(255, 255, 200, ${this.alpha})`);
                gradient.addColorStop(0.4, `rgba(255, 220, 100, ${this.alpha * 0.6})`);
                gradient.addColorStop(1, 'rgba(255, 200, 100, 0)');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(this.x, this.y, glowRadius, 0, Math.PI * 2);
                ctx.fill();

                // æ ¸å¿ƒ
                ctx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * 0.6, 0, Math.PI * 2);
                ctx.fill();

                ctx.restore();
            }

            isDead() {
                return this.alpha <= 0;
            }
        }

        // çƒŸèŠ±ç±»
        class Firework {
            constructor(x, y) {
                this.x = x;
                this.y = canvas.height;
                this.targetY = y;
                this.velocity = { x: 0, y: -config.speed };
                this.exploded = false;
                this.particles = [];
                this.trail = [];

                // éšæœºé¢œè‰²
                this.hue = Math.random() * 360;
                this.color = `hsl(${this.hue}, 100%, 60%)`;
            }

            update() {
                if (!this.exploded) {
                    this.trail.push({ x: this.x, y: this.y });
                    if (this.trail.length > 10) this.trail.shift();

                    this.velocity.y += 0.05;
                    this.y += this.velocity.y;

                    if (this.y <= this.targetY) {
                        this.explode();
                    }
                } else {
                    this.particles = this.particles.filter(particle => {
                        particle.update();
                        return !particle.isDead();
                    });
                }
            }

            explode() {
                this.exploded = true;

                // æ ¹æ®ç±»å‹åˆ›å»ºä¸åŒçš„çƒŸèŠ±æ•ˆæœ
                switch (config.type) {
                    case 'classic':
                        this.createClassicExplosion();
                        break;
                    case 'fountain':
                        this.createFountain();
                        break;
                    case 'heart':
                        this.createHeart();
                        break;
                    case 'spiral':
                        this.createSpiral();
                        break;
                    case 'ring':
                        this.createRing();
                        break;
                    case 'meteor':
                        this.createMeteor();
                        break;
                    case 'double':
                        this.createDouble();
                        break;
                    case 'star':
                        this.createStar();
                        break;
                    case 'wave':
                        this.createWave();
                        break;
                    case 'rainbow':
                        this.createRainbow();
                        break;
                    case 'cross':
                        this.createCross();
                        break;
                    case 'diamond':
                        this.createDiamond();
                        break;
                }
            }

            createClassicExplosion() {
                const particleCount = config.density;
                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 2 * i) / particleCount;
                    const speed = Math.random() * 5 + 2;
                    const velocity = {
                        x: Math.cos(angle) * speed,
                        y: Math.sin(angle) * speed
                    };

                    const hue = this.hue + Math.random() * 60 - 30;
                    const color = `hsl(${hue}, 100%, ${Math.random() * 20 + 50}%)`;

                    this.particles.push(new Particle(this.x, this.y, color, velocity));
                }
            }

            createFountain() {
                const particleCount = config.density * 1.5;
                for (let i = 0; i < particleCount; i++) {
                    const angle = Math.random() * Math.PI - Math.PI / 2;
                    const speed = Math.random() * 8 + 4;
                    const velocity = {
                        x: Math.cos(angle) * speed,
                        y: Math.sin(angle) * speed
                    };

                    const hue = this.hue + Math.random() * 30;
                    const color = `hsl(${hue}, 100%, 60%)`;

                    this.particles.push(new Particle(this.x, this.y, color, velocity, config.gravity * 1.5));
                }
            }

            createHeart() {
                const particleCount = config.density * 2;
                for (let i = 0; i < particleCount; i++) {
                    const t = (i / particleCount) * Math.PI * 2;
                    const x = 16 * Math.pow(Math.sin(t), 3);
                    const y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));

                    const speed = 3;
                    const velocity = {
                        x: x * speed * 0.1,
                        y: y * speed * 0.1
                    };

                    const color = `hsl(${340 + Math.random() * 20}, 100%, ${Math.random() * 20 + 50}%)`;

                    this.particles.push(new Particle(this.x, this.y, color, velocity, config.gravity * 0.5));
                }
            }

            createSpiral() {
                const particleCount = config.density * 1.5;
                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 4 * i) / particleCount;
                    const radius = (i / particleCount) * 5;
                    const speed = 3;
                    const velocity = {
                        x: Math.cos(angle) * speed + Math.cos(angle) * radius * 0.5,
                        y: Math.sin(angle) * speed + Math.sin(angle) * radius * 0.5
                    };

                    const hue = (this.hue + (i / particleCount) * 360) % 360;
                    const color = `hsl(${hue}, 100%, 60%)`;

                    this.particles.push(new Particle(this.x, this.y, color, velocity));
                }
            }

            createRing() {
                const rings = 3;
                const particlesPerRing = config.density / rings;

                for (let ring = 0; ring < rings; ring++) {
                    const ringRadius = (ring + 1) * 1.5;
                    for (let i = 0; i < particlesPerRing; i++) {
                        const angle = (Math.PI * 2 * i) / particlesPerRing;
                        const velocity = {
                            x: Math.cos(angle) * ringRadius,
                            y: Math.sin(angle) * ringRadius
                        };

                        const hue = this.hue + ring * 40;
                        const color = `hsl(${hue}, 100%, 60%)`;

                        this.particles.push(new Particle(this.x, this.y, color, velocity));
                    }
                }
            }

            createMeteor() {
                const meteorCount = 20;
                for (let i = 0; i < meteorCount; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 10 + 5;
                    const velocity = {
                        x: Math.cos(angle) * speed,
                        y: Math.sin(angle) * speed - 5
                    };

                    const hue = this.hue + Math.random() * 60;
                    const color = `hsl(${hue}, 100%, 70%)`;

                    const particle = new Particle(this.x, this.y, color, velocity, config.gravity * 0.3);
                    particle.size = Math.random() * 5 + config.particleSize;
                    particle.decay = 0.005;

                    this.particles.push(particle);
                }
            }

            createDouble() {
                // åŒé‡çˆ†ç‚¸ï¼šå…ˆå°çˆ†ç‚¸ï¼Œç„¶åå¤§çˆ†ç‚¸
                const particleCount = config.density * 0.5;
                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 2 * i) / particleCount;
                    const speed = Math.random() * 3 + 1;
                    const velocity = {
                        x: Math.cos(angle) * speed,
                        y: Math.sin(angle) * speed
                    };

                    const hue = this.hue + Math.random() * 30;
                    const color = `hsl(${hue}, 100%, 60%)`;

                    this.particles.push(new Particle(this.x, this.y, color, velocity));
                }

                // å»¶è¿Ÿäº§ç”Ÿå¤§çˆ†ç‚¸
                setTimeout(() => {
                    for (let i = 0; i < particleCount * 1.5; i++) {
                        const angle = (Math.PI * 2 * i) / (particleCount * 1.5);
                        const speed = Math.random() * 6 + 3;
                        const velocity = {
                            x: Math.cos(angle) * speed,
                            y: Math.sin(angle) * speed
                        };

                        const hue = this.hue + 180 + Math.random() * 30;
                        const color = `hsl(${hue}, 100%, 60%)`;

                        this.particles.push(new Particle(this.x, this.y, color, velocity));
                    }
                }, 300);
            }

            createStar() {
                // äº”è§’æ˜Ÿå½¢çŠ¶
                const points = 5;
                const particlesPerPoint = config.density / points;

                for (let point = 0; point < points; point++) {
                    const angle = (Math.PI * 2 * point) / points - Math.PI / 2;

                    for (let i = 0; i < particlesPerPoint; i++) {
                        const distance = (i / particlesPerPoint) * 8;
                        const spread = (i / particlesPerPoint) * 0.3;

                        const velocity = {
                            x: Math.cos(angle) * distance + (Math.random() - 0.5) * spread,
                            y: Math.sin(angle) * distance + (Math.random() - 0.5) * spread
                        };

                        const hue = this.hue + (point * 30);
                        const color = `hsl(${hue}, 100%, 70%)`;

                        this.particles.push(new Particle(this.x, this.y, color, velocity, config.gravity * 0.5));
                    }
                }
            }

            createWave() {
                // æ³¢æµªå½¢æ‰©æ•£
                const particleCount = config.density * 1.5;
                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 2 * i) / particleCount;
                    const waveOffset = Math.sin(i * 0.5) * 2;
                    const speed = 3 + waveOffset;

                    const velocity = {
                        x: Math.cos(angle) * speed,
                        y: Math.sin(angle) * speed
                    };

                    const hue = this.hue + (i / particleCount) * 120;
                    const color = `hsl(${hue}, 100%, 60%)`;

                    this.particles.push(new Particle(this.x, this.y, color, velocity));
                }
            }

            createRainbow() {
                // å½©è™¹è‰²ç¯
                const particleCount = config.density * 1.2;
                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 2 * i) / particleCount;
                    const speed = Math.random() * 4 + 2;

                    const velocity = {
                        x: Math.cos(angle) * speed,
                        y: Math.sin(angle) * speed
                    };

                    // å½©è™¹è‰²ï¼šæŒ‰è§’åº¦åˆ†é…é¢œè‰²
                    const hue = (i / particleCount) * 360;
                    const color = `hsl(${hue}, 100%, 60%)`;

                    this.particles.push(new Particle(this.x, this.y, color, velocity));
                }
            }

            createCross() {
                // åå­—å½¢
                const linesPerCross = 4;
                const particlesPerLine = config.density / linesPerCross;

                for (let line = 0; line < linesPerCross; line++) {
                    const baseAngle = (Math.PI / 2 * line);

                    for (let i = 0; i < particlesPerLine; i++) {
                        const distance = (i / particlesPerLine) * 6;
                        const velocity = {
                            x: Math.cos(baseAngle) * distance,
                            y: Math.sin(baseAngle) * distance
                        };

                        const hue = this.hue + (line * 90);
                        const color = `hsl(${hue}, 100%, 60%)`;

                        this.particles.push(new Particle(this.x, this.y, color, velocity, config.gravity * 0.3));
                    }
                }
            }

            createDiamond() {
                // é’»çŸ³å½¢çŠ¶ï¼ˆè±å½¢ï¼‰
                const particleCount = config.density;
                const corners = 4;

                for (let i = 0; i < particleCount; i++) {
                    const corner = Math.floor((i / particleCount) * corners);
                    const t = (i % (particleCount / corners)) / (particleCount / corners);

                    let angle;
                    if (corner === 0) angle = -Math.PI / 2 + t * Math.PI / 2;
                    else if (corner === 1) angle = 0 + t * Math.PI / 2;
                    else if (corner === 2) angle = Math.PI / 2 + t * Math.PI / 2;
                    else angle = Math.PI + t * Math.PI / 2;

                    const speed = Math.random() * 3 + 2;
                    const velocity = {
                        x: Math.cos(angle) * speed,
                        y: Math.sin(angle) * speed
                    };

                    const hue = this.hue + (corner * 60) + Math.random() * 30;
                    const color = `hsl(${hue}, 100%, 70%)`;

                    this.particles.push(new Particle(this.x, this.y, color, velocity));
                }
            }


            draw() {
                if (!this.exploded) {
                    // ç»˜åˆ¶ä¸Šå‡é˜¶æ®µçš„æ‹–å°¾
                    ctx.save();
                    this.trail.forEach((point, index) => {
                        ctx.globalAlpha = index / this.trail.length;
                        ctx.fillStyle = this.color;
                        ctx.fillRect(point.x - 2, point.y - 2, 4, 4);
                    });

                    // ç»˜åˆ¶ç«ç®­æœ¬ä½“
                    ctx.globalAlpha = 1;
                    const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, 8);
                    gradient.addColorStop(0, 'white');
                    gradient.addColorStop(1, this.color);
                    ctx.fillStyle = gradient;
                    ctx.fillRect(this.x - 3, this.y - 3, 6, 6);
                    ctx.restore();
                } else {
                    this.particles.forEach(particle => particle.draw());
                }
            }

            isDead() {
                return this.exploded && this.particles.length === 0;
            }
        }

        // æ–‡å­—çƒŸèŠ±ç±»
        class TextFirework {
            constructor(text, x, y) {
                this.text = text;
                this.x = x;
                this.y = y;
                this.progress = 0; // ä¹¦å†™è¿›åº¦ 0-1
                this.sparkParticles = []; // ç«èŠ±ç²’å­
                this.pathPoints = []; // æ–‡å­—è·¯å¾„ç‚¹
                this.isComplete = false;
                this.displayTime = config.textDisplayTime; // ä½¿ç”¨é…ç½®çš„æ˜¾ç¤ºæ—¶é•¿
                this.alpha = config.textFadeInTime > 0 ? 0 : 1; // å¦‚æœæœ‰æ¸æ˜¾ï¼Œä»0å¼€å§‹
                this.fadeInTime = config.textFadeInTime; // æ¸æ˜¾æ—¶é•¿ï¼ˆå¸§æ•°ï¼‰
                this.fadeOutTime = config.textFadeOutTime; // æ¸éšæ—¶é•¿ï¼ˆå¸§æ•°ï¼‰
                this.phase = config.textFadeInTime > 0 ? 'fadeIn' : 'writing'; // å½“å‰é˜¶æ®µï¼šfadeIn, writing, display, fadeOut

                // è·å–æ–‡å­—è·¯å¾„ç‚¹
                this.generatePathPoints();
            }

            generatePathPoints() {
                // åˆ›å»ºä¸´æ—¶canvasè·å–æ–‡å­—è½®å»“
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');

                const fontSize = 160; // æ›´å¤§çš„å­—ä½“
                tempCtx.font = `bold ${fontSize}px 'Noto Sans SC', Arial, sans-serif`;

                const metrics = tempCtx.measureText(this.text);
                const textWidth = metrics.width;

                tempCanvas.width = textWidth + 120;
                tempCanvas.height = fontSize + 120;

                tempCtx.font = `bold ${fontSize}px 'Noto Sans SC', Arial, sans-serif`;
                tempCtx.fillStyle = 'white';
                tempCtx.textBaseline = 'top';
                tempCtx.textAlign = 'left';
                tempCtx.fillText(this.text, 60, 60);

                // è·å–åƒç´ æ•°æ®
                const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
                const pixels = imageData.data;

                // æå–æ›´å¯†é›†çš„ç‚¹
                const points = [];
                const sampling = 2; // æ›´å¯†é›†çš„é‡‡æ ·

                for (let y = 0; y < tempCanvas.height; y += sampling) {
                    for (let x = 0; x < tempCanvas.width; x += sampling) {
                        const idx = (Math.floor(y) * tempCanvas.width + Math.floor(x)) * 4;
                        const alpha = pixels[idx + 3];

                        if (alpha > 128) {
                            points.push({
                                x: x - tempCanvas.width / 2 + this.x,
                                y: y - tempCanvas.height / 2 + this.y,
                                isEdge: false
                            });
                        }
                    }
                }

                this.pathPoints = points;
            }

            update() {
                // æ¸æ˜¾é˜¶æ®µ
                if (this.phase === 'fadeIn') {
                    if (this.fadeInTime > 0) {
                        this.alpha = Math.min(1, this.alpha + (1 / config.textFadeInTime));
                        this.fadeInTime--;
                        if (this.fadeInTime <= 0) {
                            this.alpha = 1;
                            this.phase = 'writing';
                        }
                    } else {
                        this.phase = 'writing';
                    }
                }

                // ä¹¦å†™é˜¶æ®µ
                if (this.phase === 'writing') {
                    // ä¹¦å†™åŠ¨ç”»ï¼ˆä½¿ç”¨é…ç½®çš„ä¹¦å†™é€Ÿåº¦ï¼‰
                    this.progress += config.textWriteSpeed;

                    if (this.progress >= 1) {
                        this.progress = 1;
                        this.isComplete = true;
                        this.phase = 'display';
                    }

                    // åœ¨ä¹¦å†™è¿‡ç¨‹ä¸­ç”Ÿæˆç«èŠ±ç²’å­
                    const visiblePointsCount = Math.floor(this.pathPoints.length * this.progress);
                    const lastFewPoints = Math.max(0, visiblePointsCount - 50);

                    // ä»æœ€è¿‘ç»˜åˆ¶çš„ç‚¹ç”Ÿæˆç«èŠ±ï¼ˆä½¿ç”¨é…ç½®çš„ç«èŠ±å¯†åº¦ï¼‰
                    for (let i = lastFewPoints; i < visiblePointsCount; i++) {
                        if (Math.random() < config.textSparkDensity) {
                            const point = this.pathPoints[i];
                            this.sparkParticles.push(new SparkParticle(point.x, point.y));
                        }
                    }
                }

                // æ˜¾ç¤ºé˜¶æ®µ
                if (this.phase === 'display') {
                    this.displayTime--;
                    if (this.displayTime <= 0) {
                        this.phase = 'fadeOut';
                    }

                    // ç»§ç»­ç”Ÿæˆå°‘é‡ç«èŠ±
                    if (Math.random() < 0.03 * config.textSparkDensity) {
                        const randomPoint = this.pathPoints[Math.floor(Math.random() * this.pathPoints.length)];
                        this.sparkParticles.push(new SparkParticle(randomPoint.x, randomPoint.y));
                    }
                }

                // æ¸éšé˜¶æ®µ
                if (this.phase === 'fadeOut') {
                    this.alpha -= 1 / this.fadeOutTime;
                    if (this.alpha < 0) {
                        this.alpha = 0;
                    }
                }

                // æ›´æ–°ç«èŠ±ç²’å­
                this.sparkParticles = this.sparkParticles.filter(p => {
                    p.update();
                    return !p.isDead();
                });
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;

                // è®¡ç®—å½“å‰åº”è¯¥æ˜¾ç¤ºå¤šå°‘ç‚¹
                const visiblePointsCount = Math.floor(this.pathPoints.length * this.progress);

                // ä½¿ç”¨é…ç½®çš„ç¬”ç”»ç²—ç»†å’Œå‘å…‰å¼ºåº¦
                const baseStrokeWidth = config.textStrokeWidth;
                const glowIntensity = config.textGlowIntensity;

                // ç»˜åˆ¶å‘å…‰æ–‡å­—ç¬”ç”»ï¼ˆå‚è€ƒå›¾3ä¼˜åŒ–é¢œè‰²ï¼‰
                // ç¬¬ä¸€å±‚ï¼šæœ€å¤–å±‚äº®é»„è‰²å‘å…‰
                ctx.shadowBlur = 35 * glowIntensity;
                ctx.shadowColor = 'rgba(255, 255, 200, 0.9)';
                for (let i = 0; i < visiblePointsCount; i++) {
                    const point = this.pathPoints[i];
                    const gradient = ctx.createRadialGradient(point.x, point.y, 0, point.x, point.y, baseStrokeWidth * 1.3);
                    gradient.addColorStop(0, 'rgba(255, 255, 240, 1)'); // æ¥è¿‘ç™½è‰²çš„äº®é»„
                    gradient.addColorStop(0.2, 'rgba(255, 250, 200, 1)'); // å¾ˆäº®çš„é»„è‰²
                    gradient.addColorStop(0.5, 'rgba(255, 235, 150, 0.9)'); // æ˜é»„
                    gradient.addColorStop(0.8, 'rgba(255, 220, 100, 0.7)'); // é‡‘é»„
                    gradient.addColorStop(1, 'rgba(255, 200, 80, 0)');
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, baseStrokeWidth * 1.3, 0, Math.PI * 2);
                    ctx.fill();
                }

                // ç¬¬äºŒå±‚ï¼šæ©™è‰²å±‚ï¼ˆæ›´é²œè‰³ï¼‰
                ctx.shadowBlur = 25 * glowIntensity;
                ctx.shadowColor = 'rgba(255, 165, 60, 1)';
                for (let i = 0; i < visiblePointsCount; i++) {
                    const point = this.pathPoints[i];
                    const gradient = ctx.createRadialGradient(point.x, point.y, 0, point.x, point.y, baseStrokeWidth * 0.9);
                    gradient.addColorStop(0, 'rgba(255, 220, 130, 1)'); // æµ…æ©™
                    gradient.addColorStop(0.3, 'rgba(255, 190, 90, 1)'); // æ˜æ©™
                    gradient.addColorStop(0.6, 'rgba(255, 150, 60, 1)'); // é²œæ©™
                    gradient.addColorStop(0.9, 'rgba(255, 120, 40, 0.8)'); // æ·±æ©™
                    gradient.addColorStop(1, 'rgba(255, 100, 20, 0)');
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, baseStrokeWidth * 0.9, 0, Math.PI * 2);
                    ctx.fill();
                }

                // ç¬¬ä¸‰å±‚ï¼šæ©™çº¢æ ¸å¿ƒ
                ctx.shadowBlur = 15 * glowIntensity;
                ctx.shadowColor = 'rgba(255, 100, 50, 1)';
                for (let i = 0; i < visiblePointsCount; i++) {
                    const point = this.pathPoints[i];
                    const gradient = ctx.createRadialGradient(point.x, point.y, 0, point.x, point.y, baseStrokeWidth * 0.6);
                    gradient.addColorStop(0, 'rgba(255, 200, 100, 1)'); // æµ…æ©™é»„
                    gradient.addColorStop(0.3, 'rgba(255, 140, 70, 1)'); // æ©™è‰²
                    gradient.addColorStop(0.6, 'rgba(255, 100, 50, 1)'); // æ©™çº¢
                    gradient.addColorStop(1, 'rgba(230, 70, 40, 0.9)'); // æ·±çº¢æ©™
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, baseStrokeWidth * 0.6, 0, Math.PI * 2);
                    ctx.fill();
                }

                // ç¬¬å››å±‚ï¼šæ˜äº®æ ¸å¿ƒ
                ctx.shadowBlur = 8 * glowIntensity;
                ctx.shadowColor = 'rgba(255, 255, 255, 1)';
                for (let i = 0; i < visiblePointsCount; i++) {
                    const point = this.pathPoints[i];
                    const gradient = ctx.createRadialGradient(point.x, point.y, 0, point.x, point.y, baseStrokeWidth * 0.3);
                    gradient.addColorStop(0, 'rgba(255, 255, 255, 1)'); // çº¯ç™½
                    gradient.addColorStop(0.4, 'rgba(255, 240, 200, 1)'); // äº®é»„ç™½
                    gradient.addColorStop(0.7, 'rgba(255, 200, 130, 1)'); // é‡‘é»„
                    gradient.addColorStop(1, 'rgba(255, 160, 100, 0.8)'); // æ©™é»„
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, baseStrokeWidth * 0.3, 0, Math.PI * 2);
                    ctx.fill();
                }

                ctx.shadowBlur = 0;
                ctx.restore();

                // ç»˜åˆ¶ç«èŠ±ç²’å­
                this.sparkParticles.forEach(p => p.draw());
            }

            isDead() {
                return this.alpha <= 0;
            }
        }

        // çƒŸèŠ±æ•°ç»„
        let fireworks = [];
        let textFireworks = []; // æ–‡å­—çƒŸèŠ±å•ç‹¬æ•°ç»„

        // æ‰€æœ‰çƒŸèŠ±ç±»å‹
        const allFireworkTypes = [
            'classic', 'fountain', 'heart', 'spiral',
            'ring', 'meteor', 'double', 'star',
            'wave', 'rainbow', 'cross', 'diamond'
        ];

        // å…¨éƒ¨æ•ˆæœæ¨¡å¼ - åŒæ—¶ç»½æ”¾æ‰€æœ‰ç±»å‹
        function startAllEffectsMode() {
            if (config.allEffectsMode) {
                // åœæ­¢æ¨¡å¼
                stopAllEffectsMode();
                return;
            }

            config.allEffectsMode = true;
            document.getElementById('allEffectsBtn').classList.add('active');
            document.getElementById('allEffectsBtn').textContent = 'ğŸ›‘ åœæ­¢æ•ˆæœ';

            // ä¿å­˜åŸå§‹å¯†åº¦
            const originalDensity = config.density;
            // é™ä½ç²’å­å¯†åº¦ä»¥æå‡æ€§èƒ½
            config.density = Math.max(50, Math.floor(config.density * 0.5));

            // åˆ›å»ºå®šæ—¶å™¨ï¼Œæ¯è½®åŒæ—¶å‘å°„æ‰€æœ‰ç±»å‹çš„çƒŸèŠ±
            config.allEffectsInterval = setInterval(() => {
                // éšæœºé€‰æ‹©2-4ç§çƒŸèŠ±ç±»å‹åŒæ—¶å‘å°„ï¼ˆé¿å…å¤ªå¯†é›†ï¼‰
                const selectedTypes = [];
                const typeCount = Math.floor(Math.random() * 3) + 2; // 2-4ç§ç±»å‹

                for (let i = 0; i < typeCount; i++) {
                    const randomIndex = Math.floor(Math.random() * allFireworkTypes.length);
                    const type = allFireworkTypes[randomIndex];
                    if (!selectedTypes.includes(type)) {
                        selectedTypes.push(type);
                    }
                }

                // ä¸ºæ¯ç§é€‰ä¸­çš„ç±»å‹å‘å°„1-2ä¸ªçƒŸèŠ±
                selectedTypes.forEach((type, typeIndex) => {
                    const count = Math.floor(Math.random() * 2) + 1; // æ¯ç§ç±»å‹1-2ä¸ªçƒŸèŠ±

                    for (let i = 0; i < count; i++) {
                        setTimeout(() => {
                            // å‡åŒ€åˆ†å¸ƒåœ¨å±å¹•ä¸Š
                            const sectionWidth = canvas.width / selectedTypes.length;
                            const minX = sectionWidth * typeIndex + 50;
                            const maxX = sectionWidth * (typeIndex + 1) - 50;
                            const x = minX + Math.random() * (maxX - minX);
                            const y = Math.random() * canvas.height * 0.4 + 80;

                            // ä¸´æ—¶åˆ‡æ¢çƒŸèŠ±ç±»å‹
                            const originalType = config.type;
                            config.type = type;

                            const firework = new Firework(x, y);
                            fireworks.push(firework);

                            // æ¢å¤åŸå§‹ç±»å‹
                            config.type = originalType;
                        }, i * 200 + typeIndex * 100); // äº¤é”™å‘å°„
                    }
                });
            }, 1500); // æ¯1.5ç§’å‘å°„ä¸€è½®
        }

        function stopAllEffectsMode() {
            config.allEffectsMode = false;
            if (config.allEffectsInterval) {
                clearInterval(config.allEffectsInterval);
                config.allEffectsInterval = null;
            }
            document.getElementById('allEffectsBtn').classList.remove('active');
            document.getElementById('allEffectsBtn').textContent = 'ğŸ† å…¨éƒ¨æ•ˆæœ';
            // æ¢å¤é»˜è®¤å¯†åº¦
            document.getElementById('density').value = 100;
            config.density = 100;
            document.getElementById('densityValue').textContent = '100';
        }

        // åˆ›å»ºæ–‡å­—çƒŸèŠ±çš„å‡½æ•°
        function createTextFirework(text) {
            if (!text || text.trim() === '') {
                alert('è¯·å…ˆè¾“å…¥è¦æ˜¾ç¤ºçš„æ–‡å­—ï¼');
                return;
            }

            // æ¸…ç©ºä¹‹å‰çš„æ–‡å­—çƒŸèŠ±ï¼Œç¡®ä¿æ¯æ¬¡åªæ˜¾ç¤ºä¸€ä¸ª
            textFireworks = [];

            // åˆ›å»ºæ–°çš„æ–‡å­—çƒŸèŠ±
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2 - 50;

            const textFirework = new TextFirework(text, centerX, centerY);
            textFireworks.push(textFirework);
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            requestAnimationFrame(animate);

            // æ£€æŸ¥æ˜¯å¦æœ‰æ–‡å­—çƒŸèŠ±
            const hasTextFirework = textFireworks.length > 0;

            if (hasTextFirework) {
                // å¦‚æœæœ‰æ–‡å­—çƒŸèŠ±ï¼Œä½¿ç”¨æ›´æ·±çš„åŠé€æ˜é®ç½©ï¼Œè®©æ–‡å­—æ›´æ¸…æ™°
                ctx.fillStyle = 'rgba(5, 5, 16, 0.05)';
            } else {
                // æ™®é€šçƒŸèŠ±ä½¿ç”¨æ­£å¸¸é®ç½©
                ctx.fillStyle = 'rgba(5, 5, 16, 0.15)';
            }
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // æ›´æ–°å’Œç»˜åˆ¶æ™®é€šçƒŸèŠ±
            fireworks = fireworks.filter(firework => {
                firework.update();
                firework.draw();
                return !firework.isDead();
            });

            // æ›´æ–°å’Œç»˜åˆ¶æ–‡å­—çƒŸèŠ±
            textFireworks = textFireworks.filter(tf => {
                tf.update();
                tf.draw();
                return !tf.isDead();
            });

            // è‡ªåŠ¨æ¨¡å¼
            if (config.autoMode && Math.random() < 0.05) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height * 0.5 + 50;
                fireworks.push(new Firework(x, y));
            }
        }

        // ç‚¹å‡»äº‹ä»¶
        canvas.addEventListener('click', (e) => {
            const x = e.clientX;
            const y = e.clientY;
            fireworks.push(new Firework(x, y));
        });

        // æ§åˆ¶é¢æ¿äº‹ä»¶
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                config.type = this.dataset.type;
            });
        });

        document.getElementById('density').addEventListener('input', function() {
            config.density = parseInt(this.value);
            document.getElementById('densityValue').textContent = this.value;
        });

        document.getElementById('speed').addEventListener('input', function() {
            config.speed = parseInt(this.value);
            document.getElementById('speedValue').textContent = this.value;
        });

        document.getElementById('gravity').addEventListener('input', function() {
            config.gravity = parseFloat(this.value);
            document.getElementById('gravityValue').textContent = this.value;
        });

        document.getElementById('particleSize').addEventListener('input', function() {
            config.particleSize = parseFloat(this.value);
            document.getElementById('particleSizeValue').textContent = this.value;
        });

        // æ–‡å­—çƒŸèŠ±å‚æ•°æ§åˆ¶
        document.getElementById('strokeWidth').addEventListener('input', function() {
            config.textStrokeWidth = parseInt(this.value);
            document.getElementById('strokeWidthValue').textContent = this.value;
        });

        document.getElementById('sparkDensity').addEventListener('input', function() {
            config.textSparkDensity = parseFloat(this.value);
            document.getElementById('sparkDensityValue').textContent = this.value;
        });

        document.getElementById('sparkSize').addEventListener('input', function() {
            config.textSparkSize = parseFloat(this.value);
            document.getElementById('sparkSizeValue').textContent = this.value;
        });

        document.getElementById('glowIntensity').addEventListener('input', function() {
            config.textGlowIntensity = parseFloat(this.value);
            document.getElementById('glowIntensityValue').textContent = this.value;
        });

        document.getElementById('writeSpeed').addEventListener('input', function() {
            config.textWriteSpeed = parseFloat(this.value) * 0.01; // è½¬æ¢ä¸ºå®é™…é€Ÿåº¦å€¼
            document.getElementById('writeSpeedValue').textContent = this.value;
        });

        // é¢æ¿æŠ˜å åŠŸèƒ½
        document.getElementById('togglePanel').addEventListener('click', function() {
            const panel = document.getElementById('controlPanel');
            const expandBtn = document.getElementById('expandBtn');

            panel.classList.toggle('hidden');
            expandBtn.classList.toggle('show');
        });

        // å±•å¼€æŒ‰é’®åŠŸèƒ½
        document.getElementById('expandBtn').addEventListener('click', function() {
            const panel = document.getElementById('controlPanel');
            const expandBtn = document.getElementById('expandBtn');

            panel.classList.remove('hidden');
            expandBtn.classList.remove('show');
        });

        // æ ‡é¢˜å¯ç¼–è¾‘åŠŸèƒ½
        const mainTitle = document.getElementById('mainTitle');
        mainTitle.addEventListener('blur', function() {
            config.pageTitle = this.textContent;
        });

        mainTitle.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                this.blur();
            }
        });

        document.getElementById('autoBtn').addEventListener('click', function() {
            config.autoMode = !config.autoMode;
            this.classList.toggle('active');
            this.textContent = config.autoMode ? 'åœæ­¢è‡ªåŠ¨' : 'è‡ªåŠ¨æ¨¡å¼';

            // å¦‚æœå¼€å¯è‡ªåŠ¨æ¨¡å¼ï¼Œå…³é—­å…¨éƒ¨æ•ˆæœæ¨¡å¼
            if (config.autoMode && config.allEffectsMode) {
                stopAllEffectsMode();
            }
        });

        document.getElementById('allEffectsBtn').addEventListener('click', function() {
            startAllEffectsMode();

            // å¦‚æœå¼€å¯å…¨éƒ¨æ•ˆæœæ¨¡å¼ï¼Œå…³é—­è‡ªåŠ¨æ¨¡å¼
            if (config.allEffectsMode && config.autoMode) {
                config.autoMode = false;
                document.getElementById('autoBtn').classList.remove('active');
                document.getElementById('autoBtn').textContent = 'è‡ªåŠ¨æ¨¡å¼';
            }
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            fireworks = [];
            textFireworks = [];
            ctx.fillStyle = 'rgba(5, 5, 16, 1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // åœæ­¢å…¨éƒ¨æ•ˆæœæ¨¡å¼
            if (config.allEffectsMode) {
                stopAllEffectsMode();
            }
        });

        // æ–‡å­—çƒŸèŠ±æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('textFireworkBtn').addEventListener('click', () => {
            const text = document.getElementById('textInput').value;
            createTextFirework(text);
        });

        // æ”¯æŒæŒ‰å›è½¦é”®è§¦å‘æ–‡å­—çƒŸèŠ±
        document.getElementById('textInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const text = document.getElementById('textInput').value;
                createTextFirework(text);
            }
        });

        // çª—å£è°ƒæ•´
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // å¯åŠ¨åŠ¨ç”»
        animate();

        // æ¬¢è¿çƒŸèŠ±ç§€
        setTimeout(() => {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const x = canvas.width / 2 + (Math.random() - 0.5) * 400;
                    const y = canvas.height / 3 + (Math.random() - 0.5) * 200;
                    fireworks.push(new Firework(x, y));
                }, i * 300);
            }
        }, 500);
    </script>
</body>
</html>